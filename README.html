<!-- ?xml version='1.0' encoding='UTF-8'? -->
<link href="./files/github-css.css" rel="stylesheet"/>
<meta charset="utf-8" content="text/html"/>
<div class="gist">
<style class="formula-style">
        svg.gh-md-to-html-formula {
            fill: black;
        }
    </style>
<div class="gist-file"> <!-- This is the class that is responsible for the boxing! -->
<div class="gist-data">
<div class="js-gist-file-update-container js-task-list-container file-box">
<div class="file" id="user-content-article-README">
<div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="user-content-file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px">
<article class="markdown-body entry-content container-lg" itemprop="text">
<h1 id="user-content-yabridge">
<a aria-hidden="true" class="anchor" href="#user-content-yabridge" id="user-content-yabridge" name="user-content-yabridge"><span aria-hidden="true" class="octicon octicon-link"></span></a>yabridge</h1>
<p><a href="https://discord.gg/pyNeweqadf" rel="nofollow"><img alt="" data-canonical-src="https://img.shields.io/discord/786993304197267527.svg?label=Discord&amp;logo=discord&amp;logoColor=ffffff&amp;color=7389D8&amp;labelColor=6A7EC2" src="https://img.shields.io/discord/786993304197267527.svg?label=Discord&amp;logo=discord&amp;logoColor=ffffff&amp;color=7389D8&amp;labelColor=6A7EC2" style="max-width:100%;"/></a></p>
<p>Yet Another way to use Windows VST plugins on Linux. Yabridge seamlessly
supports using both 32-bit and 64-bit Windows VST2 and VST3 plugins in a 64-bit
Linux VST host as if they were native VST2 and VST3 plugins, with optional
support for <a href="#user-content-plugin-groups">plugin groups</a> to enable inter-plugin communication
for VST2 plugins and quick startup times. Its modern concurrent architecture and
focus on transparency allows yabridge to be both fast and highly compatible,
while also staying easy to debug and maintain.</p>
<p><a href="./files/screenshot.png" rel="nofollow" target="_blank"><img alt="yabridge screenshot" data-canonical-src="./files/screenshot.png" src="./files/screenshot.png" style="max-width:100%; max-height: 1440px;"/></a></p>
<h3 id="user-content-table-of-contents">
<a aria-hidden="true" class="anchor" href="#user-content-table-of-contents" id="user-content-table-of-contents" name="user-content-table-of-contents"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of contents</h3>
<ul>
<li><a href="#user-content-tested-with">Tested with</a></li>
<li>
<a href="#user-content-usage"><strong>Usage</strong></a>
<ul>
<li><a href="#user-content-bitbridge">Bitbridge</a></li>
<li><a href="#user-content-wine-prefixes">Wine prefixes</a></li>
<li><a href="#user-content-drag-and-drop">Drag-and-drop</a></li>
<li><a href="#user-content-input-focus-grabbing">Input focus grabbing</a></li>
<li><a href="#user-content-downgrading-wine">Downgrading Wine</a></li>
<li><a href="#user-content-installing-a-development-build">Installing a development build</a></li>
</ul>
</li>
<li>
<a href="#user-content-configuration">Configuration</a>
<ul>
<li><a href="#user-content-plugin-groups">Plugin groups</a></li>
<li><a href="#user-content-compatibility-options">Compatibility options</a></li>
<li><a href="#user-content-example">Example</a></li>
</ul>
</li>
<li><a href="#user-content-known-issues-and-fixes"><strong>Known issues and fixes</strong></a></li>
<li><a href="#user-content-troubleshooting-common-issues"><strong>Troubleshooting common issues</strong></a></li>
<li>
<a href="#user-content-performance-tuning"><strong>Performance tuning</strong></a>
<ul>
<li><a href="#user-content-environment-configuration">Environment configuration</a></li>
</ul>
</li>
<li>
<a href="#user-content-building">Building</a>
<ul>
<li><a href="#user-content-32-bit-bitbridge">32-bit bitbridge</a></li>
<li><a href="#user-content-32-bit-libraries">32-bit libraries</a></li>
</ul>
</li>
<li>
<a href="#user-content-debugging">Debugging</a>
<ul>
<li><a href="#user-content-attaching-a-debugger">Attaching a debugger</a></li>
</ul>
</li>
</ul>
<h2 id="user-content-tested-with">
<a aria-hidden="true" class="anchor" href="#user-content-tested-with" id="user-content-tested-with" name="user-content-tested-with"><span aria-hidden="true" class="octicon octicon-link"></span></a>Tested with</h2>
<p>Yabridge has been tested under the following hosts using Wine Staging 7.10:</p>
<table>
<thead>
<tr>
<th>Host</th>
<th>VST2</th>
<th>VST3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bitwig Studio 4.2.5/4.3 beta*</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>REAPER 6.59</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>Carla 2.4.2</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>Qtractor 0.9.25</td>
<td>✔️</td>
<td>⚠️ VST3 editor window may not have the correct size</td>
</tr>
<tr>
<td>Renoise 3.3.2</td>
<td>✔️</td>
<td>⚠️ Renoise doesn't handle VST3 editor window sizing correctly</td>
</tr>
<tr>
<td>Waveform 11.5.18</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>Ardour 6.9</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>Mixbus 7.0.140</td>
<td>✔️</td>
<td>✔️</td>
</tr>
</tbody>
</table>
<p>Please let me know if there are any issues with other hosts.</p>
<sup>
  *Bitwig Studio (4.3)'s Flatpak version will not work with yabridge. You'll need to use the .deb found on the release notes page instead.
</sup>
<h2 id="user-content-usage">
<a aria-hidden="true" class="anchor" href="#user-content-usage" id="user-content-usage" name="user-content-usage"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>
<ol start="0">
<li>
<p>First of all, yabridge requires a recent-ish version of Wine (Staging). Users
of Debian, Ubuntu, Linux Mint and Pop!_OS should install Wine Staging from
the <a href="https://wiki.winehq.org/Download" rel="nofollow">WineHQ repositories</a> as the Wine
versions provided by those distro's repositories may be too old to be used
with yabridge. On other distros you should be able to just install
<code>wine-staging</code> using your distro's package manager.</p>
<p>For a general overview on how to use Wine to install Windows applications,
check out Wine's <a href="https://wiki.winehq.org/Wine_User%27s_Guide#Using_Wine" rel="nofollow">user
guide</a>.</p>
</li>
<li>
<p>Depending on your distro you can install yabridge and its yabridgectl
companion utility through your distro's package manager or by using the using
a binary archive from the GitHub releases page. Keep in mind that the distro
packages mentioned below may not always be up to date, and some may also not
be compiled with support for 32-bit plugins.</p>
<ul>
<li>
<p>On <strong>Arch</strong> and <strong>Manjaro</strong>, yabridge and yabridgectl can be installed from
the official repositories using the
<a href="https://archlinux.org/packages/multilib/x86_64/yabridge/" rel="nofollow"><code>yabridge</code></a> and
<a href="https://archlinux.org/packages/multilib/x86_64/yabridgectl/" rel="nofollow"><code>yabridgectl</code></a>
packages.</p>
</li>
<li>
<p>On <strong>Fedora</strong>, you can install yabridge and yabridgectl from a
<a href="https://copr.fedorainfracloud.org/coprs/patrickl/yabridge/" rel="nofollow">COPR</a>.</p>
</li>
<li>
<p>On the <strong>OpenSUSE</strong> distros, yabridge and yabridgectl are packaged by
<a href="https://geekosdaw.tuxfamily.org/en/" rel="nofollow">GeekosDAW</a>.</p>
</li>
<li>
<p>On <strong>NixOS</strong>, yabridge and yabridgectl are in the repositories.</p>
</li>
<li>
<p>On <strong>Ubuntu</strong>, <strong>Debian</strong>, <strong>Linux Mint</strong>, <strong>Pop!_OS</strong>, and any other
distro, you can simply download and install a prebuilt version of yabridge:</p>
<ol>
<li>
<p>First download the latest version of yabridge from the <a href="https://github.com/robbert-vdh/yabridge/releases">releases
page</a>. If you're using
a distro that's older than Ubuntu 20.04 such as Ubuntu 18.04, Debian 10,
Linux Mint 19, or AV Linux MXE 2021, then you should download the
version that ends with <code>-ubuntu-18.04.tar.gz</code>.</p>
</li>
<li>
<p>Extract the contents of the downloaded archive to <code>~/.local/share</code>, such
that the file <code>~/.local/share/yabridge/yabridgectl</code> exists after
extracting. You can extract an archive here from the command line with
<code>tar -C ~/.local/share -xavf yabridge-x.y.z.tar.gz</code>. If you're
extracting the archive using a GUI file manager or archive tool, then
make sure that hidden files and directories are visible by pressing
<kbd>Ctrl+H</kbd>.</p>
</li>
<li>
<p><strong>Whenever any step below mentions running <code>yabridgectl &lt;something&gt;</code>,
then you should run <code>~/.local/share/yabridge/yabridgectl &lt;something&gt;</code>
instead</strong> as <code>~/.local/share/yabridge</code> is not in your search path so
your shell won't be able to find yabridgectl otherwise.</p>
<p>Alternatively, you can also add that directory to your shell's search
path so you'll be able to run <code>yabridgectl</code> directly. If you don't know
what that means, then add <code>export PATH="$PATH:$HOME/.local/share/yabridge"</code>
to the end of <code>~/.bashrc</code> and reopen your terminal.</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>Setting up and updating yabridge for your plugins is done though
<code>yabridgectl</code>. The general idea is that you install your plugins to their
default locations within a Wine prefix just like you would on Windows, and
you yabridgectl then manages those plugin directories for you. That way you
only need to run a single command whenever you install or remove a plugin.
Both yabridge and yabridgectl will autoamtically detect your yabridge
installation if you used one of the installation methods described above.</p>
</li>
<li>
<p>To tell yabridgectl where it can find your Windows VST2 and VST3 plugins, you
can use yabridgectl's <code>add</code>, <code>rm</code> and <code>list</code> commands to add, remove, and
list the plugin directories yabridgectl is managing for you. You can also use
<code>yabridgectl status</code> to get an overview of the current settings and the
installation status for all of your plugins.</p>
<ol>
<li>To add the most common VST2 plugin directory in the default Wine prefix, use
<code>yabridgectl add "$HOME/.wine/drive_c/Program Files/Steinberg/VstPlugins"</code>.
This directory may be capitalized as <code>VSTPlugins</code> on your system, and some
plugins may also install themselves to a similar directory directly inside
of Program Files.</li>
<li>VST3 plugins under Windows are always installed to the same directory, and
you can use <code>yabridgectl add "$HOME/.wine/drive_c/Program Files/Common Files/VST3"</code>
to add that one.</li>
</ol>
</li>
<li>
<p>Finally, you'll need to run <code>yabridgectl sync</code> to finish setting up yabridge
for all of your plugins. After doing so, your VST2 plugins will be set up in
<code>~/.vst/yabridge</code>, and your VST3 plugins are set up in <code>~/.vst3/yabridge</code>.
Make sure your DAW searches both <code>~/.vst</code> and <code>~/.vst3</code> for plugins and
you'll be good to go.</p>
</li>
</ol>
<h3 id="user-content-bitbridge">
<a aria-hidden="true" class="anchor" href="#user-content-bitbridge" id="user-content-bitbridge" name="user-content-bitbridge"><span aria-hidden="true" class="octicon octicon-link"></span></a>Bitbridge</h3>
<p>If you have downloaded the prebuilt version of yabridge or if have followed the
instructions from the <a href="#user-content-32-bit-bitbridge">bitbridge</a> section below, then
yabridge is also able to load 32-bit VST2 and VST3 plugins. The installation
procedure for 32-bit plugins is exactly the same as for 64-bit plugins. Yabridge
will automatically detect whether a plugin is 32-bit or 64-bit on startup and it
will handle it accordingly.</p>
<p>If you want to use the 32-bit version of a VST3 plugin when you also have the
64-bit version installed, then you may have to enable the <code>vst3_prefer_32bit</code>
<a href="https://github.com/robbert-vdh/yabridge#compatibility-options">compatibility
option</a> if those
two plugins are located in the same VST3 bundle in <code>~/.vst3/yabridge</code>.</p>
<h3 id="user-content-wine-prefixes">
<a aria-hidden="true" class="anchor" href="#user-content-wine-prefixes" id="user-content-wine-prefixes" name="user-content-wine-prefixes"><span aria-hidden="true" class="octicon octicon-link"></span></a>Wine prefixes</h3>
<p>It is also possible to use yabridge with multiple Wine prefixes. Yabridge will
automatically detect and use the Wine prefix the plugin's <code>.dll</code> or <code>.vst3</code> file
is located in. Alternatively, you can set the <code>WINEPREFIX</code> environment variable
to override the Wine prefix for <em>all instances</em> of yabridge.</p>
<h3 id="user-content-drag-and-drop">
<a aria-hidden="true" class="anchor" href="#user-content-drag-and-drop" id="user-content-drag-and-drop" name="user-content-drag-and-drop"><span aria-hidden="true" class="octicon octicon-link"></span></a>Drag-and-drop</h3>
<p>Yabridge supports drag-and-drop both from a native (X11) Linux application to
plugins running under yabridge, as well as drag-and-drop from yabridge to native
X11 applications like your DAW. When dragging things from a plugin to your DAW,
then depending on which DAW you're using it may look like the drop is going to
fail while still hodling down the left mouse button. That's expected, since both
yabridge's and Wine's own drag-and-drop systems are active at the same time. If
you're using yabridge in <em>REAPER</em> or <em>Carla</em>, then you may need to enable a
<a href="#user-content-compatibility-options">compatibility option</a> to prevent those hosts from
stealing the drop.</p>
<h3 id="user-content-input-focus-grabbing">
<a aria-hidden="true" class="anchor" href="#user-content-input-focus-grabbing" id="user-content-input-focus-grabbing" name="user-content-input-focus-grabbing"><span aria-hidden="true" class="octicon octicon-link"></span></a>Input focus grabbing</h3>
<p>Yabridge tries to be clever about the way grabbing input focus for a plugin and
subsequently giving it back to the host works. One important detail here is that
when grabbing input focus, yabridge will always focus the <em>parent window</em> passed
by the host for the plugin to embed itself into. This means that hosts like
Bitwig Studio can still process common keys like <kbd>Space</kbd> for play/pause
even while interacting with a plugin's GUI. The downside of this approach is
that this also means that in those hosts you simply cannot type a space
character, as the key will always go to the host.</p>
<p>For the very specific situations where you may want to focus the plugin's editor
directly so that all keyboard input goes to Wine, you can hold down the
<kbd>Shift</kbd> key while entering the plugin's GUI with your mouse. This will
let you type spaces in text fields in <strong>Bitwig Studio</strong>, type text into the
settings and license dialogs in <strong>Voxengo</strong> plugins, and it will also allow you
to navigate dropdowns with the keyboard.</p>
<h3 id="user-content-downgrading-wine">
<a aria-hidden="true" class="anchor" href="#user-content-downgrading-wine" id="user-content-downgrading-wine" name="user-content-downgrading-wine"><span aria-hidden="true" class="octicon octicon-link"></span></a>Downgrading Wine</h3>
<p>If you run into software or a plugin that does not work correctly with the
current version of Wine Staging, then you may want to try downgrading to an
earlier version of Wine. This can be done as follows:</p>
<ul>
<li>
<p>On Debian, Ubuntu, Linux Mint and other apt-based distros, you can use the
command below to install Wine Staging 6.14 after you add the WineHQ
repositories linked above. This command is a bit cryptic because on these
distros the Wine package is split up into multiple smaller packages, and the
package versions include the distros codename (e.g. <code>focal</code>, or <code>buster</code>) as
well as some numeric suffix. Change the version to whatever version of Wine
you want to install, and then run these commands under Bash:</p>
<div class="highlight highlight-source-shell"><pre>version=6.14
variant=staging
codename=<span class="pl-s"><span class="pl-pds">$(</span>shopt -s nullglob<span class="pl-k">;</span> awk <span class="pl-s"><span class="pl-pds">'</span>/^deb https:\/\/dl\.winehq\.org/ { print $3; exit }<span class="pl-pds">'</span></span> /etc/apt/sources.list /etc/apt/sources.list.d/<span class="pl-k">*</span>.list<span class="pl-pds">)</span></span>
suffix=<span class="pl-s"><span class="pl-pds">$(</span>dpkg --compare-versions <span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$version</span><span class="pl-pds">"</span></span> ge 6.1 <span class="pl-k">&amp;&amp;</span> <span class="pl-s"><span class="pl-pds">((</span>dpkg <span class="pl-k">--</span>compare<span class="pl-k">-</span>versions "<span class="pl-smi">$version</span>" ge <span class="pl-c1">6</span>.<span class="pl-c1">17</span> <span class="pl-k">&amp;&amp;</span> echo "<span class="pl-k">-</span><span class="pl-c1">2</span>") <span class="pl-k">||</span> echo "<span class="pl-k">-</span><span class="pl-c1">1</span>"<span class="pl-pds">))</span></span></span>
<span class="pl-s">sudo apt install --install-recommends {<span class="pl-s"><span class="pl-pds">"</span>winehq-<span class="pl-smi">$variant</span><span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>wine-<span class="pl-smi">$variant</span><span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>wine-<span class="pl-smi">$variant</span>-amd64<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>wine-<span class="pl-smi">$variant</span>-i386<span class="pl-pds">"</span></span>}=<span class="pl-s"><span class="pl-pds">"</span><span class="pl-smi">$version</span>~<span class="pl-smi">$codename$suffix</span><span class="pl-pds">"</span></span></span></pre></div>
<p>If you want to prevent these packages from being updated automatically, then
you can do so with:</p>
<div class="highlight highlight-source-shell"><pre>sudo apt-mark hold winehq-staging</pre></div>
<p>Running the same command with <code>unhold</code> instead of <code>hold</code> will enable updates
again.</p>
</li>
<li>
<p>On Arch and Manjaro, you can install the
<a href="https://aur.archlinux.org/packages/downgrade/" rel="nofollow">downgrade</a> tool from the repos
or the AUR, then run:</p>
<div class="highlight highlight-source-shell"><pre>sudo env DOWNGRADE_FROM_ALA=1 downgrade wine-staging</pre></div>
<p>Then select the package for the wine-staging version you want to isntall from
the list. After installing downgrade will ask if you want to add the package
to <code>IgnorePkg</code>. If you select <code>yes</code>, the package will be added to the
<code>IgnorePkg</code> field in <code>/etc/pacman.conf</code> and it won't be updated again
automatically.</p>
</li>
</ul>
<h3 id="user-content-installing-a-development-build">
<a aria-hidden="true" class="anchor" href="#user-content-installing-a-development-build" id="user-content-installing-a-development-build" name="user-content-installing-a-development-build"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installing a development build</h3>
<p>If you want to try to a development version of yabridge, then you can do so as
follows:</p>
<ul>
<li>On Arch and Manjaro, you can install the latest master branch version of
yabridge by installing the
<a href="https://aur.archlinux.org/packages/yabridge-git/" rel="nofollow">yabridge-git</a> and
<a href="https://aur.archlinux.org/packages/yabridgectl-git/" rel="nofollow">yabridgectl-git</a> AUR
packages.</li>
<li>Otherwise, you can find development builds on the <a href="https://github.com/robbert-vdh/yabridge/actions?query=workflow%3A%22Automated+builds%22+branch%3Amaster">automated build
page</a>.
Before you can download these files, you need log in to GitHub. Then simply
select the latest commit with a green checkmark next to it, scroll down the
build page, and download the latest yabridge and yabridgectl binaries that
match your system. You can also access the very latest build from <a href="https://nightly.link/robbert-vdh/yabridge/workflows/build/master" rel="nofollow">this
page</a>
without logging in to GitHub. You'll need to extract these files twice, since
GitHub automatically puts the tarball inside of a .zip archive. Then simply
overwrite the existing files in <code>~/.local/share/yabridge</code> with the ones from
the <code>yabridge</code> directory, and replace <code>~/.local/share/yabridge/yabridgectl</code>
with the new <code>yabridgectl/yabridgectl</code> binary. It's also possible to use these
builds if you're using a distro package, but then you should remove the
package first in order to avoid conflicts.</li>
</ul>
<p>After updating yabridge's files, you will need to rerun <code>yabridgectl sync</code> to
finish the upgrade.</p>
<h2 id="user-content-configuration">
<a aria-hidden="true" class="anchor" href="#user-content-configuration" id="user-content-configuration" name="user-content-configuration"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h2>
<p>Yabridge can be configured on a per plugin basis to host multiple plugins within
a single process using <a href="#user-content-plugin-groups">plugin groups</a>, and there are also a
number of <a href="#user-content-compatibility-options">compatibility options</a> available to improve
compatibility with certain hosts and plugins.</p>
<p>Configuring yabridge is done through a <code>yabridge.toml</code> file located in either
the same directory as the plugin's <code>.so</code> file you're trying to configure, or in
any of its parent directories. In most cases, you'll want to create this file as
either <code>~/.vst/yabridge/yabridge.toml</code> or <code>~/.vst3/yabridge/yabridge.toml</code>.
Configuration files contain several <em>sections</em>. Each section can match one or
more plugins using case sensitive
<a href="https://www.man7.org/linux/man-pages/man7/glob.7.html" rel="nofollow">glob</a> patterns that
match paths to yabridge <code>.so</code> files relative to the <code>yabridge.toml</code> file. If a
section is matched for a plugin, then the settings under that section are
applied to the plugin. To avoid confusion, only the first <code>yabridge.toml</code> file
found and only the first matching glob pattern within that file will be
considered. See below for an <a href="#user-content-example">example</a> of a <code>yabridge.toml</code> file. To
make debugging easier, yabridge will print the used <code>yabridge.toml</code> file and the
matched section within it on startup, as well as all of the options that have
been set.</p>
<h3 id="user-content-plugin-groups">
<a aria-hidden="true" class="anchor" href="#user-content-plugin-groups" id="user-content-plugin-groups" name="user-content-plugin-groups"><span aria-hidden="true" class="octicon octicon-link"></span></a>Plugin groups</h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>group</code></td>
<td><code>{"&lt;string&gt;",""}</code></td>
<td>Defaults to <code>""</code>, meaning that the plugin will be hosted individually.</td>
</tr>
</tbody>
</table>
<p>Some plugins have the ability to communicate with other instances of that same
plugin or even with other plugins made by the same manufacturer. This is often
used in mixing plugins to allow different tracks to reference each other without
having to route audio between them. Examples of plugins that do this are
FabFilter Pro-Q 3, MMultiAnalyzer and the iZotope mixing plugins. In order for
this to work, all instances of a particular plugin will have to be hosted in the
same process.</p>
<p>Yabridge has the concept of <em>plugin groups</em>, which are user defined groups of
plugins that will all be hosted inside of a single process. Plugins groups can
be configured for a plugin by setting the <code>group</code> option of that plugin to some
name. All plugins with the same group name will be hosted within a single
process. Of course, plugin groups with the same name but in different Wine
prefixes and with different architectures will be run independently of each
other. See below for an <a href="#user-content-example">example</a> of how these groups can be set up.</p>
<p><em>Note that because of the way VST3 works, multiple instances of a single VST3
plugin will always be hosted in a single process regardless of whether you have
enabled plugin groups or not.</em> <em>The only reason to use plugin groups with VST3
plugins is to get slightly lower loading times the first time you load a new
plugin.</em></p>
<h3 id="user-content-compatibility-options">
<a aria-hidden="true" class="anchor" href="#user-content-compatibility-options" id="user-content-compatibility-options" name="user-content-compatibility-options"><span aria-hidden="true" class="octicon octicon-link"></span></a>Compatibility options</h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>disable_pipes</code></td>
<td><code>{true,false,&lt;string&gt;}</code></td>
<td>When this option is enabled, yabridge will redirect the Wine plugin host's output streams to a file without any further processing. See the <a href="#user-content-known-issues-and-fixes">known issues</a> section for a list of plugins where this may be useful. This can be set to a boolean, in which case the output will be written to <code>$XDG_RUNTIME_DIR/yabridge-plugin-output.log</code>, or to an absolute path (with no expansion for tildes or environment variables). Defaults to <code>false</code>.</td>
</tr>
<tr>
<td><code>editor_coordinate_hack</code></td>
<td><code>{true,false}</code></td>
<td>Compatibility option for plugins that rely on the absolute screen coordinates of the window they're embedded in. Since the Wine window gets embedded inside of a window provided by your DAW, these coordinates won't match up and the plugin would end up drawing in the wrong location without this option. Currently the only known plugins that require this option are <em>PSPaudioware E27</em> and <em>Soundtoys Crystallizer</em>. Defaults to <code>false</code>.</td>
</tr>
<tr>
<td><code>editor_force_dnd</code></td>
<td><code>{true,false}</code></td>
<td>This option forcefully enables drag-and-drop support in <em>REAPER</em>. Because REAPER's FX window supports drag-and-drop itself, dragging a file onto a plugin editor will cause the drop to be intercepted by the FX window. This makes it impossible to drag files onto plugins in REAPER under normal circumstances. Setting this option to <code>true</code> will strip drag-and-drop support from the FX window, thus allowing files to be dragged onto the plugin again. Defaults to <code>false</code>.</td>
</tr>
<tr>
<td><code>editor_xembed</code></td>
<td><code>{true,false}</code></td>
<td>Use Wine's XEmbed implementation instead of yabridge's normal window embedding method. Some plugins will have redrawing issues when using XEmbed and editor resizing won't always work properly with it, but it could be useful in certain setups. You may need to use <a href="https://github.com/psycha0s/airwave/blob/master/fix-xembed-wine-windows.patch">this Wine patch</a> if you're getting blank editor windows. Defaults to <code>false</code>.</td>
</tr>
<tr>
<td><code>frame_rate</code></td>
<td><code>&lt;number&gt;</code></td>
<td>The rate at which Win32 events are being handled and usually also the refresh rate of a plugin's editor GUI. When using plugin groups all plugins share the same event handling loop, so in those the last loaded plugin will set the refresh rate. Defaults to <code>60</code>.</td>
</tr>
<tr>
<td><code>hide_daw</code></td>
<td><code>{true,false}</code></td>
<td>Don't report the name of the actual DAW to the plugin. See the <a href="#user-content-known-issues-and-fixes">known issues</a> section for a list of situations where this may be useful. This affects both VST2 and VST3 plugins. Defaults to <code>false</code>.</td>
</tr>
<tr>
<td><code>vst3_no_scaling</code></td>
<td><code>{true,false}</code></td>
<td>Disable HiDPI scaling for VST3 plugins. Wine currently does not have proper fractional HiDPI support, so you might have to enable this option if you're using a HiDPI display. In most cases setting the font DPI in <code>winecfg</code>'s graphics tab to 192 will cause plugins to scale correctly at 200% size. Defaults to <code>false</code>.</td>
</tr>
<tr>
<td><code>vst3_prefer_32bit</code></td>
<td><code>{true,false}</code></td>
<td>Use the 32-bit version of a VST3 plugin instead the 64-bit version if both are installed and they're in the same VST3 bundle inside of <code>~/.vst3/yabridge</code>. You likely won't need this.</td>
</tr>
</tbody>
</table>
<p>These options are workarounds for issues mentioned in the <a href="#user-content-known-issues-and-fixes">known
issues</a> section. Depending on the hosts
and plugins you use you might want to enable some of them.</p>
<h3 id="user-content-example">
<a aria-hidden="true" class="anchor" href="#user-content-example" id="user-content-example" name="user-content-example"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h3>
<p>All of the paths used here are relative to the <code>yabridge.toml</code> file. A
configuration file for VST2 plugins might look a little something like this:</p>
<div class="highlight highlight-source-toml"><pre><span class="pl-c"><span class="pl-c">#</span> ~/.vst/yabridge/yabridge.toml</span>

[<span class="pl-en">"FabFilter</span> <span class="pl-en">Pro-Q</span> <span class="pl-en">3</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>fabfilter<span class="pl-pds">"</span></span>

[<span class="pl-en">"MeldaProduction/Tools/MMultiAnalyzer</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>melda<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> Matches an entire directory and all files inside it, make sure to not include</span>
<span class="pl-c"><span class="pl-c">#</span> a trailing slash</span>
[<span class="pl-en">"ToneBoosters"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>toneboosters<span class="pl-pds">"</span></span>

[<span class="pl-en">"PSPaudioware"</span>]
<span class="pl-smi">editor_coordinate_hack</span> = <span class="pl-c1">true</span>

[<span class="pl-en">"Analog</span> <span class="pl-en">Lab</span> <span class="pl-en">3</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">editor_xembed</span> = <span class="pl-c1">true</span>

[<span class="pl-en">"Chromaphone</span> <span class="pl-en">3</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">hide_daw</span> = <span class="pl-c1">true</span>

[<span class="pl-en">"sforzando</span> <span class="pl-en">VST_x64</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">editor_force_dnd</span> = <span class="pl-c1">true</span>
<span class="pl-smi">frame_rate</span> = <span class="pl-c1">24</span>

[<span class="pl-en">"LoopCloud*"</span>]
<span class="pl-smi">disable_pipes</span> = <span class="pl-c1">true</span>

<span class="pl-c"><span class="pl-c">#</span> Simple glob patterns can be used to avoid unneeded repetition</span>
[<span class="pl-en">"iZotope*/Neutron</span> <span class="pl-en">*"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>izotope<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> Since this file has already been matched by the above glob pattern, this won't</span>
<span class="pl-c"><span class="pl-c">#</span> do anything</span>
[<span class="pl-en">"iZotope7/Neutron</span> <span class="pl-en">2</span> <span class="pl-en">Mix</span> <span class="pl-en">Tap</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>This will be ignored!<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> Of course, you can also add multiple plugins to the same group by hand</span>
[<span class="pl-en">"iZotope7/Insight</span> <span class="pl-en">2</span>.<span class="pl-en">so"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>izotope<span class="pl-pds">"</span></span>

<span class="pl-c"><span class="pl-c">#</span> This would cause all plugins to be hosted within a single process. Doing so</span>
<span class="pl-c"><span class="pl-c">#</span> greatly reduces the loading time of individual plugins, with the caveat being</span>
<span class="pl-c"><span class="pl-c">#</span> that plugins are no longer sandboxed from each other.</span>
<span class="pl-c"><span class="pl-c">#</span></span>
<span class="pl-c"><span class="pl-c">#</span> ["*"]</span>
<span class="pl-c"><span class="pl-c">#</span> group = "all"</span></pre></div>
<p>For VST3 plugins you should just match the directory instead of the <code>.so</code> file
deep within in, like this:</p>
<div class="highlight highlight-source-toml"><pre><span class="pl-c"><span class="pl-c">#</span> ~/.vst3/yabridge/yabridge.toml</span>

[<span class="pl-en">"FabFilter*</span>.<span class="pl-en">vst3"</span>]
<span class="pl-smi">group</span> = <span class="pl-s"><span class="pl-pds">"</span>fabfilter<span class="pl-pds">"</span></span>
<span class="pl-smi">vst3_no_scaling</span> = <span class="pl-c1">true</span>

[<span class="pl-en">"Chromaphone</span> <span class="pl-en">3</span>.<span class="pl-en">vst3"</span>]
<span class="pl-smi">hide_daw</span> = <span class="pl-c1">true</span>

[<span class="pl-en">"Misstortion2</span>.<span class="pl-en">vst3"</span>]
<span class="pl-smi">vst3_no_scaling</span> = <span class="pl-c1">true</span>

[<span class="pl-en">"*/*Spectral*</span>.<span class="pl-en">vst3"</span>]
<span class="pl-smi">vst3_prefer_32bit</span> = <span class="pl-c1">true</span>

<span class="pl-c"><span class="pl-c">#</span> These options would be applied to all plugins that do not already have their</span>
<span class="pl-c"><span class="pl-c">#</span> own configuration set</span>
[<span class="pl-en">"*"</span>]
<span class="pl-smi">editor_force_dnd</span> = <span class="pl-c1">true</span>
<span class="pl-smi">vst3_no_scaling</span> = <span class="pl-c1">true</span></pre></div>
<h2 id="user-content-known-issues-and-fixes">
<a aria-hidden="true" class="anchor" href="#user-content-known-issues-and-fixes" id="user-content-known-issues-and-fixes" name="user-content-known-issues-and-fixes"><span aria-hidden="true" class="octicon octicon-link"></span></a>Known issues and fixes</h2>
<p>Any plugin should function out of the box, although some plugins will need some
additional dependencies for their GUIs to work correctly. Notable examples
include:</p>
<ul>
<li>
<p>If plugins have missing, invisible, or misaligned text, then installing
<code>corefonts</code> or <code>allfonts</code> through <code>winetricks</code> may help.</p>
</li>
<li>
<p><strong>Serum</strong> requires you to disable <code>d2d1.dll</code> in <code>winecfg</code> and to install
<code>gdiplus</code> through <code>winetricks</code>. You may also want to disable the tooltips by
going to the global settings tab, unchecking 'Show help tooltips', and
clicking on the save icon next to 'Preferences'.</p>
</li>
<li>
<p><strong>Native Instruments</strong> plugins work, but Native Access is unable to finish
installing the plugins. To work around this you can open the .iso file
downloaded to your downloads directory and run the installer directly. <em>With
Wine (Staging) 6.8 or later Native Access might also not be able to finish the
download, in which case you should downgrade Wine first using the
<a href="#user-content-downgrading-wine">instructions above</a>.</em> You may also have to manually
terminate the ISO driver installation process when installing Native Access
for the first time to allow the installation to proceed. Some Native
Instruments .iso files contain hidden files, and the installer will fail
unless you mount the .iso file with the correct mounting options. To do this,
first run <code>udisksctl loop-setup -f ~/Downloads/&lt;filename&gt;.iso</code> to load the
.iso file, and then use <code>udisksctl mount -t udf -o unhide -b /dev/loopX</code> where
<code>/dev/loopX</code> corresponds to the loop device printed by the <code>loop-setup</code>
command to mount the .iso file to a directory in <code>/run/media</code>.</p>
<p>If you're using an older distro and you're getting a
<code>Mount option 'unhide' is not allowed</code> error when trying to mount the file,
then you may need to manually create or edit <code>/etc/udisks2/mount_options.conf</code>
first, adding the following to the file:</p>
<pre lang="conf"><code>[defaults]
udf_allow=uid=$UID,gid=$GID,iocharset,utf8,umask,mode,dmode,unhide,undelete
</code></pre>
</li>
<li>
<p>If <strong>Spitfire Audio</strong> plugins like <strong>BBC Symphony Orchestra</strong> and <strong>LABS</strong> are
unable to load their sample libraries (<em>Error #X: Something went wrong</em>), then
you can try reinstalling those plugins to a new, clean Wine prefix. To avoid
potential confusion, make sure to uninstall the Spitfire software along with
the VST2 and VST3 plugins from your main Wine prefix first.</p>
</li>
<li>
<p>Several <strong>JUCE</strong> based plugins have an issue under Wine where the mouse cursor
will disappear after interacting with certain UI elements. This can usually be
fixed by mousing over the resize handle in the bottom right corner.</p>
</li>
<li>
<p>Several (JUCE-based) plugins like <strong>Arturia</strong>'s plugins, Sonic Academy's
<strong>Kick 2</strong> and Cytomic's <strong>The Drop</strong> have an issue where the GUI freezes when
it's trying to display a tooltip. This can be fixed by enabling the '<em>Hide
Wine version from applications</em>' option in the Staging tab of winecfg. If a
plugin seems to function normally but then freezes when clicking on something,
then try enabling this option.</p>
</li>
<li>
<p>The GUI in <strong>Sforzando</strong> may appear to not respond to mouse clicks depending
on your Wine and system configuration. This is actually a redrawing issue, and
the GUI will still be updated even if it doesn't look that way. Dragging the
window around or just clicking anywhere in the GUI will force a redraw and
make the GUI render correctly again.</p>
</li>
<li>
<p><strong>MeldaProduction</strong> plugins have minor rendering issues when GPU acceleration
is enabled. This can be fixed by disabling GPU acceleration in the plugin
settings. I'm not sure whether this is an issue with Wine or the plugins
themselves. Notable issues here are missing redraws and incorrect positioning
when the window gets dragged offscreen on the top and left sides of the screen.</p>
</li>
<li>
<p>Knobs in <strong>Tokyo Dawn Records</strong> plugins may not behave as expected when
dragging long distances. Setting the 'Continuous Drag' option in the plugin's
options to 'Linear' fixes the issue.</p>
</li>
<li>
<p>Similarly, the knobs in <strong>Voxengo</strong> plugins behave better when you enable the
'Radial knob mode' setting in the global settings.</p>
</li>
<li>
<p>If <strong>Scaler 2</strong>'s interface lags, blacks out, or otherwise renders poorly,
then you can try enabling <a href="https://forum.scalerplugin.com/t/scaler-2-black-empty-window/3540/8" rel="nofollow">software
rendering</a>
to fix these issues.</p>
</li>
<li>
<p><strong>ujam</strong> plugins and other plugins made with the Gorilla Engine, such as the
<strong>LoopCloud</strong> plugins, will throw a <code>JS_EXEC_FAILED</code> error when trying to load
the plugin. Enabling the <code>disable_pipes</code> <a href="#user-content-compatibility-options">compatibility
option</a> for those plugins will fix this.</p>
</li>
<li>
<p>Plugins by <strong>KiloHearts</strong> have file descriptor leaks when <em>esync</em> is enabled,
causing Wine and yabridge to eventually stop working after the system hits the
open file limit. To fix this, either unset <code>WINEESYNC</code> while using yabridge or
switch to using <a href="#user-content-performance-tuning"><em>fsync</em></a> instead.</p>
</li>
<li>
<p><strong>PSPaudioware</strong> and <strong>Soundtoys</strong> plugins with expandable GUIs, such as E27
and Crystallizer, may have their GUI appear in the wrong location after the
GUI has been expanded. You can enable an alternative <a href="#user-content-compatibility-options">editor hosting
mode</a> to fix this.</p>
</li>
<li>
<p>When using recent <em>Applied Acoustics</em> plugins like <strong>Chromaphone 3</strong> under
<em>Bitwig Studio</em>, text entry will cause the plugin to crash because Chromaphone
uses a different text entry method when it detects Bitwig. You can use the
<code>hide_daw</code> <a href="#user-content-compatibility-options">compatibility option</a> to work around this.</p>
</li>
<li>
<p>VST2 plugins like <strong>FabFilter Pro-Q 3</strong> that can share data between different
instances of the same plugin plugins have to be hosted within a single process
for that functionality to work. See the <a href="#user-content-plugin-groups">plugin groups</a>
section for instructions on how to set this up. This is not necessary for VST3
plugins, as multiple instances of those plugins will always be hosted in a
single process by design.</p>
</li>
<li>
<p>Some hosts, particularly <em>Ardour</em>, <em>REAPER</em>, <em>Qtractor</em>, will by default not
unload VST3 modules after you close the last plugin. This means that the
associated <code>yabridge-host.exe</code> process will keep running until you close the
project. For REAPER there's an option called
<code>Allow complete unload of VST plug-ins</code> in the <code>VST</code> tab of the settings
dialog to disable this behaviour.</p>
</li>
<li>
<p><em>Drag-and-drop</em> to the plugin window under <strong>REAPER</strong> doesn't work because of
a long standing issue in REAPER's FX window implementation. You can use a
compatibility option to <a href="#user-content-compatibility-options">force drag-and-drop</a> to work
around this limitation.</p>
</li>
</ul>
<p>Aside from that, these are some known caveats:</p>
<ul>
<li>
<strong>iZotope</strong> plugins can't be authorized because of missing functionality in
Wine's crypt32 implementation.</li>
<li>
<strong>D16 Group</strong> plugins also can't be authorized in current versions of Wine as
they don't recall their authorization status correctly.</li>
<li>
<strong>Waves</strong> V13 VST3 plugins have memory issues, at least under Wine. They will
likely randomly crash at some point. If you can avoid Waves, that would be for
the best. Otherwise, try the V12 versions of the plugins if you still have a
license for them.</li>
<li>MIDI key labels for VST2 plugins (commonly used for drum machines and
multisamplers) will not be updated after the host first asks for them since
VST 2.4 has no way to let the host know that those labels have been updated.
Deactivating and reactivating the plugin will cause these labels to be updated
again for the current patch.</li>
<li>The Cinnamon desktop environment has some quirks with its window management
that affect yabridge's plugin editor embedding. Most notably some plugins may
flicker while dragging windows around, and there may be <a href="https://github.com/robbert-vdh/yabridge/issues/89">rendering
issues</a> when using multiple
monitors depending on which screen has been set as primary. Enabling the
XEmbed <a href="#user-content-compatibility-options">compatibility option</a> may help, but Wine's
XEmbed implementation also introduces other rendering issues.</li>
</ul>
<p>There are also some third party extension features for both VST2.4 and VST3 that
have not been implemented yet. See the <a href="./ROADMAP.md">roadmap</a> for a list of
future plans.</p>
<h2 id="user-content-troubleshooting-common-issues">
<a aria-hidden="true" class="anchor" href="#user-content-troubleshooting-common-issues" id="user-content-troubleshooting-common-issues" name="user-content-troubleshooting-common-issues"><span aria-hidden="true" class="octicon octicon-link"></span></a>Troubleshooting common issues</h2>
<p>If your problem is not listed here, then feel free to post on the <a href="https://github.com/robbert-vdh/yabridge/issues">issue
tracker</a> or to ask about it in
the yabridge <a href="https://discord.gg/pyNeweqadf" rel="nofollow">Discord</a>.</p>
<ul>
<li>
<p>Both yabridgectl and yabridge try to diagnose many common issues for you. If
you're running into crashes or other issues, then try launching your DAW from
a terminal and reading the log output for any clues. Bitwig Studio writes
plugin output to <code>~/.BitwigStudio/log/engine.log</code>, so you may need to look
there instead.</p>
</li>
<li>
<p>If yabridge prints errors or warnings about memory locking limits, then that
means that you have not yet set up realtime privileges for your user. Setting
the memlock limit to unlimited (or -1) is usually part of this process. How
you should do this will depend on your distro. On <em>Arch</em> and <em>Manjaro</em>, you
will need to install the <code>realtime-privileges</code> package, add your user to the
<code>realtime</code> group with <code>sudo gpasswd -a "$USER" realtime</code>, and then reboot.
<em>Fedora</em> does the same thing with their <code>realtime-setup</code> package, which also
sets up a <code>realtime</code> group that you will need to add your user to. On
<em>Debian</em>, <em>Ubuntu</em>, and distros based on those, the <code>jackd2</code> package usually
sets this up for the <code>audio</code> group instead. If
<code>/etc/security/limits.d/audio.conf</code> exists, then you can simply add yourself
to the <code>audio</code> group and reboot. In any other case you may need to <a href="https://jackaudio.org/faq/linux_rt_config.html" rel="nofollow">set this
up yourself</a>.</p>
</li>
<li>
<p>The above process also applies to warnings about low <code>RLIMIT_RTTIME</code> values
when using PipeWire's JACK implementation. If you don't change this, then
certain slow loading plugins may crash during initialization or at any other
time. <strong>Starting with PipeWire 0.3.44, you only need to make sure your user
has realtime privileges to resolve this warning.</strong> If your user does not have
these permissions, then PipeWire will use RTKit instead of regular realtime
scheduling which requires this limit to be set for it to work. You may also
want to give <a href="https://github.com/robbert-vdh/dotfiles#pipewire">this</a>
optimized PipeWire configuration a try.</p>
</li>
<li>
<p>If you have the <code>WINEPREFIX</code> environment variable set and you <em>don't</em> want all
of your plugins to use that specific Wine prefix, then you should unset it to
allow yabridge to automatically detect Wine prefixes for you.</p>
</li>
<li>
<p>If you're seeing errors related to Wine either when running <code>yabridgectl sync</code>
or when trying to load a plugin, then it can be that your installed version of
Wine is much older than the version that yabridge has been compiled for.
Yabridgectl will automatically check for this when you run <code>yabridgectl sync</code>
after updating Wine or yabridge. You can also manually verify that Wine is
working correctly by running one of the VST host applications. Assuming that
yabridge is installed under <code>~/.local/share/yabridge</code>, then running
<code>~/.local/share/yabridge/yabridge-host.exe</code> directly (so <em>not</em>
<code>wine ~/.local/share/yabridge/yabridge-host.exe</code>, that won't work) in a
terminal should print a few messages related to Wine's startup process
followed by the following line:</p>
<pre><code>Usage: yabridge-host.exe &lt;plugin_type&gt; &lt;plugin_location&gt; &lt;endpoint_base_directory&gt;
</code></pre>
<p>If you're seeing a <code>002b:err:module:__wine_process_init</code> error instead, then
your version of Wine is too old for this version of yabridge and you'll have
to upgrade your Wine version. Instructions for how to do this on Ubuntu can be
found on the <a href="https://wiki.winehq.org/Ubuntu" rel="nofollow">WineHQ website</a>.</p>
<p>If you're getting a <code>0024:err:process:exec_process</code> error, then your Wine
prefix is set to 32-bit only and it won't be possible to run 64-bit
applications like <code>yabridge-host.exe</code>.</p>
</li>
<li>
<p>Sometimes left over Wine processes can cause problems. Run <code>wineserver -k</code> to
terminate Wine related in the current or default Wine prefix.</p>
</li>
<li>
<p>If plugin windows show up as a large overlay over the entire screen, covering
up other windows and making it impossible to interact with anything else
without Alt+Tabbing to them, then make sure the 'Allow the window manager to
control the windows' checkbox in winecfg's Graphics tab is checked.</p>
</li>
<li>
<p>If you're using a <em>lot</em> of plugins and you're unable to load any new plugins,
then you may be running into Xorg's limit of 256 clients. The exact number of
plugins it takes for this to happen will depend on your system and the other
applications running in the background. An easy way to check if this is the
case would be to try and run <code>wine cmd.exe</code> from a terminal. If this prints a
message about the maximum number of clients being reached (or if you are not
able to open the terminal at all), then you might want to consider using
<a href="#user-content-plugin-groups">plugin groups</a> to run multiple instances of your most
frequently used plugins within a single process. And if you're using many
instances of a single VST2 plugin, using the VST3 version of that plugin may
also help since they'll share a single process.</p>
</li>
<li>
<p>If you're using a <code>WINELOADER</code> that runs the Wine process under a separate
namespace while the host is not sandboxed, then you'll have to use the
<code>YABRIDGE_NO_WATCHDOG</code> environment variable to disable the watchdog timer. If
you know what this means then you probably know what you're doing. In that
case, you may also want to use <code>YABRIDGE_TEMP_DIR</code> to choose a different
directory for yabridge to store its sockets and other temporary files in.</p>
</li>
</ul>
<h2 id="user-content-performance-tuning">
<a aria-hidden="true" class="anchor" href="#user-content-performance-tuning" id="user-content-performance-tuning" name="user-content-performance-tuning"><span aria-hidden="true" class="octicon octicon-link"></span></a>Performance tuning</h2>
<p>Running Windows plugins under Wine should have a minimal performance overhead,
but you may still notice an increase in latency spikes and overall DSP load.
Luckily there are a few things you can do to get rid of most or all of these
negative side effects:</p>
<ul>
<li>
<p>First of all, you'll want to make sure that you can run programs with realtime
scheduling. Note that on Arch and Manjaro this does not necessarily require a
realtime kernel as they include the <code>PREEMPT</code> patch set in their regular
kernels. You can verify that this is working correctly by running <code>chrt -f 10 whoami</code>, which should print your username, and running <code>uname -a</code> should print
something that contains <code>PREEMPT</code> in the output.</p>
</li>
<li>
<p>You can also try enabling the <code>threadirqs</code> kernel parameter and using which
can in some situations help with xruns. After enabling this, you can use
<a href="https://github.com/rncbc/rtirq#rtirq">rtirq</a> to increase the priority of
interrupts for your sound card.</p>
</li>
<li>
<p>Make sure that you're using the performance frequency scaling governor, as
changing clock speeds in the middle of a real time workload can cause latency
spikes.</p>
</li>
<li>
<p>The last but perhaps the most important thing you can do is to use a build of
Wine compiled with Proton's fsync or FUTEX2 patches. This can improve
performance significantly when using certain multithreaded plugins. If you are
running Arch or Manjaro, then you can use <a href="https://github.com/Frogging-Family/wine-tkg-git">Tk-Glitch's Wine
fork</a> for a customizable
version of Wine with the fsync patches included. Make sure to follow the
instructions in the readme and don't try to use the prebuilt releases as they
will have fshack enabled which tends to break many plugins that use Direct3D
for their rendering. You'll also want to make sure you're running Linux kernel
5.16 or newer as those include support the <code>_fsync_futex_waitv</code> option that's
enabled by default though wine-tkg's <code>customization.cfg</code>. Finally, you'll have
to set the <code>WINEFSYNC</code> environment variable to <code>1</code> to enable fsync. See the
<a href="#user-content-environment-configuration">environment configuration</a> section below for more
information on where to set this environment variable so that it gets picked
up when you start your DAW.</p>
</li>
<li>
<p>If you have the choice, the VST3 version of a plugin will likely perform
better than the VST2 version.</p>
</li>
<li>
<p>If the plugin doesn't have a VST3 version, then <a href="#user-content-plugin-groups">plugin
groups</a> can also greatly improve performance when many
instances of same VST2 plugin. <em>VST3 plugins have similar functionality built
in by design</em>. Some plugins, like the BBC Spitfire plugins, can share a lot of
resources between different instances of the plugin. Hosting all instances of
the same plugin in a single process can in those cases greatly reduce overall
CPU usage and get rid of latency spikes.</p>
</li>
</ul>
<h3 id="user-content-environment-configuration">
<a aria-hidden="true" class="anchor" href="#user-content-environment-configuration" id="user-content-environment-configuration" name="user-content-environment-configuration"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment configuration</h3>
<p>This section is relevant if you want to configure environment variables in such
a way that they will be set when you launch your DAW from the GUI instead of
from a terminal. You may want to enable <code>WINEFSYNC</code> for fsync support with a
compatible Wine version and kernel, or you may want to change your search <code>PATH</code>
to allow yabridge to find the <code>yabridge-*.exe</code> binaries if you're using yabridge
directly from the <code>build</code> directory. To do this you'll need to change your
<em>login shell's</em> profile, which is different from the configuration loaded during
interactive sessions. And some display manager override your login shell to
always use <code>/bin/sh</code>, so you need to be careful to modify the correct file or
else these changes won't work. You can find out your current login shell by
running <code>echo $SHELL</code> in a terminal.</p>
<ul>
<li>
<p>First of all, if you're using GDM, LightDM or LXDM as your display manager
(for instance if you're using GNOME, XFCE or LXDE), then your display manager
won't respect your login shell and it will always use <code>/bin/sh</code>. In that case
you will need to add the following line to <code>~/.profile</code> to enable fsync:</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-k">export</span> WINEFSYNC=1</pre></div>
</li>
<li>
<p>If you are using the default <strong>Bash</strong> shell and you're not using any of the
above display managers, then you will want to add the following line to
<code>~/.bash_profile</code> (or <code>~/.profile</code> if the former does not exist):</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-k">export</span> WINEFSYNC=1</pre></div>
</li>
<li>
<p>If you are using <strong>Zsh</strong>, then you can add the following line to <code>~/.zprofile</code>
(<code>~/.zshenv</code> should also work, but some distros such as Arch Linux overwrite
the environment after this file has been read):</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-k">export</span> WINEFSYNC=1</pre></div>
</li>
<li>
<p>If you are using <strong>fish</strong>, then you can add the following line to either
<code>~/.config/fish/config.fish</code> or some file in <code>~/.config/fish/conf.d/</code>:</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c1">set</span> -gx WINEFSYNC 1
<span class="pl-c"><span class="pl-c">#</span> Or if you're changing your PATH:</span>
<span class="pl-c1">set</span> -gp fish_user_paths <span class="pl-k">~</span>/directory/with/yabridge/binaries</pre></div>
</li>
</ul>
<p><em>Make sure to log out and log back in again to ensure that all applications pick
up the new changes.</em></p>
<h2 id="user-content-building">
<a aria-hidden="true" class="anchor" href="#user-content-building" id="user-content-building" name="user-content-building"><span aria-hidden="true" class="octicon octicon-link"></span></a>Building</h2>
<p>To compile yabridge, you'll need <a href="https://mesonbuild.com/index.html" rel="nofollow">Meson</a> and
the following dependencies:</p>
<ul>
<li>GCC 10+<a href="#user-content-building-ubuntu-18.04">*</a>
</li>
<li>A Wine installation with <code>winegcc</code> and the development headers. The latest
commits contain a workaround for a winelib <a href="https://bugs.winehq.org/show_bug.cgi?id=49138" rel="nofollow">compilation
issue</a> with Wine 5.7+.</li>
<li>libxcb</li>
</ul>
<p>The following dependencies are included in the repository as a Meson wrap:</p>
<ul>
<li><a href="http://think-async.com/Asio/" rel="nofollow">Asio</a></li>
<li><a href="https://github.com/fraillt/bitsery">bitsery</a></li>
<li><a href="https://github.com/Naios/function2">function2</a></li>
<li><a href="https://github.com/gulrak/filesystem"><code>ghc::filesystem</code></a></li>
<li><a href="https://github.com/marzer/tomlplusplus">tomlplusplus</a></li>
<li>Version 3.7.3 of the <a href="https://github.com/robbert-vdh/vst3sdk">VST3 SDK</a> with
some <a href="https://github.com/robbert-vdh/yabridge/blob/master/tools/patch-vst3-sdk.sh">patches</a>
to allow Winelib compilation</li>
</ul>
<p>The project can then be compiled with the command below. You can remove or
change the unity size argument if building takes up too much RAM, or you can
disable unity builds completely by getting rid of <code>--unity=on</code> at the cost of
slightly longer build times.</p>
<div class="highlight highlight-source-shell"><pre>meson setup build --buildtype=release --cross-file=cross-wine.conf --unity=on --unity-size=1000
ninja -C build</pre></div>
<p>After you've finished building you can follow the instructions under the
<a href="#user-content-usage">usage</a> section on how to set up yabridge.</p>
<sup id="user-content-building-ubuntu-18.04">
  *The version of GCC that ships with Ubuntu 18.04 by default is too old to
  compile yabridge. If you do wish to build yabridge from scratch rather than
  using the <a href="https://github.com/robbert-vdh/yabridge/actions?query=workflow%3A%22Automated+builds%22+branch%3Amaster">prebuilt
  binaries</a>, then you should take a look at the <a href="https://github.com/robbert-vdh/docker-yabridge/blob/master/bionic/Dockerfile">docker
  image</a> used when building yabridge on Ubuntu 18.04 for on overview of what
  would need to be installed to compile on Ubuntu 18.04.
</sup>
<h3 id="user-content-32-bit-bitbridge">
<a aria-hidden="true" class="anchor" href="#user-content-32-bit-bitbridge" id="user-content-32-bit-bitbridge" name="user-content-32-bit-bitbridge"><span aria-hidden="true" class="octicon octicon-link"></span></a>32-bit bitbridge</h3>
<p>It is also possible to compile a host application for yabridge that's compatible
with 32-bit plugins such as old SynthEdit plugins. This will allow yabridge to
act as a bitbridge, allowing you to run old 32-bit only Windows VST2 plugins in
a modern 64-bit Linux VST host. For this you'll need to have installed the 32
bit versions of the XCB library. This can then be set up as follows:</p>
<div class="highlight highlight-source-shell"><pre><span class="pl-c"><span class="pl-c">#</span> Enable the bitbridge on an existing build</span>
meson configure build -Dbitbridge=true
<span class="pl-c"><span class="pl-c">#</span> Or configure a new build from scratch</span>
meson setup build --buildtype=release --cross-file cross-wine.conf -Dbitbridge=true

ninja -C build</pre></div>
<p>This will produce a second plugin host binary called <code>yabridge-host-32.exe</code>.
Yabridge will detect whether the plugin you're trying to load is 32-bit or
64-bit, and will run either the regular version or the <code>*-32.exe</code> variant
accordingly.</p>
<h3 id="user-content-32-bit-libraries">
<a aria-hidden="true" class="anchor" href="#user-content-32-bit-libraries" id="user-content-32-bit-libraries" name="user-content-32-bit-libraries"><span aria-hidden="true" class="octicon octicon-link"></span></a>32-bit libraries</h3>
<p>It also possible to build 32-bit versions of yabridge's libraries, which would
let you use both 32-bit and 64-bit Windows VST2 and VST3 plugins from a 32-bit
Linux plugin host. This is mostly untested since 32-bit only Linux applications
don't really exist anymore, but it should work! The build system will still
assume you're compiling from a 64-bit system, so if you're compiling on an
actual 32-bit system you would need to comment out the 64-bit <code>yabridge-host</code>
and <code>yabridge-group</code> binaries in <code>meson.build</code>:</p>
<div class="highlight highlight-source-shell"><pre>meson setup build --buildtype=release --cross-file=cross-wine.conf --unity=on --unity-size=1000 -Dbitbridge=true -Dbuild.cpp_args=<span class="pl-s"><span class="pl-pds">'</span>-m32<span class="pl-pds">'</span></span> -Dbuild.cpp_link_args=<span class="pl-s"><span class="pl-pds">'</span>-m32<span class="pl-pds">'</span></span>
ninja -C build</pre></div>
<p>Like the above commands, you might need to tweak the unity size based on the
amount of system memory available. See the CI build definitions for some
examples on how to add static linking in the mix if you're going to run this
version of yabridge on some other machine.</p>
<h2 id="user-content-debugging">
<a aria-hidden="true" class="anchor" href="#user-content-debugging" id="user-content-debugging" name="user-content-debugging"><span aria-hidden="true" class="octicon octicon-link"></span></a>Debugging</h2>
<p>Wine's error messages and warning are usually very helpful whenever a plugin
doesn't work right away. However, with some VST hosts it can be hard read a
plugin's output. To make it easier to debug malfunctioning plugins, yabridge
offers these two environment variables to control yabridge's logging facilities:</p>
<ul>
<li>
<p><code>YABRIDGE_DEBUG_FILE=&lt;path&gt;</code> allows you to write yabridge's debug messages as
well as all output produced by the plugin and by Wine itself to a file. For
instance, you could launch your DAW with
<code>env YABRIDGE_DEBUG_FILE=/tmp/yabridge.log &lt;daw&gt;</code>, and then use
<code>tail -F /tmp/yabridge.log</code> to keep track of the output. If this option is not
present then yabridge will write all of its debug output to STDERR instead.</p>
</li>
<li>
<p><code>YABRIDGE_DEBUG_LEVEL={0,1,2}{,+editor}</code> allows you to set the verbosity of
the debug information. You can set a debug level, optionally followed by
<code>+editor</code> to also get more debug output related to the editor window handling.
Each level increases the amount of debug information printed:</p>
<ul>
<li>A value of <code>0</code> (the default) means that yabridge will only log the output
from the Wine process and some basic information about the
environment, the configuration and the plugin being loaded.</li>
<li>A value of <code>1</code> will log detailed information about most events and function
calls sent between the VST host and the plugin. This filters out some noisy
events such as <code>effEditIdle()</code> and <code>audioMasterGetTime()</code> since those are
sent multiple times per second by for every plugin.</li>
<li>A value of <code>2</code> will cause all of the events to be logged without any
filtering. This is very verbose but it can be crucial for debugging
plugin-specific problems.</li>
</ul>
<p>More detailed information about these debug levels can be found in
<code>src/common/logging.h</code>.</p>
</li>
</ul>
<p>See the <a href="https://github.com/robbert-vdh/yabridge/blob/master/.github/ISSUE_TEMPLATE/bug_report.yml">bug report
template</a>
for an example of how to use this.</p>
<p>Wine's own <a href="https://wiki.winehq.org/Debug_Channels" rel="nofollow">logging facilities</a> can also
be very helpful when diagnosing problems. In particular the <code>+message</code>,
<code>+module</code> and <code>+relay</code> channels are very useful to trace the execution path
within the loaded VST plugin itself.</p>
<h3 id="user-content-attaching-a-debugger">
<a aria-hidden="true" class="anchor" href="#user-content-attaching-a-debugger" id="user-content-attaching-a-debugger" name="user-content-attaching-a-debugger"><span aria-hidden="true" class="octicon octicon-link"></span></a>Attaching a debugger</h3>
<p>To debug the plugin, you can just attach gdb to the host. Debugging the Wine
plugin host is a bit trickier. Wine comes with a GDB proxy for winedbg, but it
requires a little bit of additional setup and it expects the command line
arguments to be a valid Win32 command line. You'll also need to launch winedbg
in a seperate detached terminal emulator so it doesn't terminate together with
the plugin, and winedbg can be a bit picky about the arguments it accepts. I've
already set this up behind a feature flag for use in KDE Plasma. Other desktop
environments and window managers will require some slight modifications in
<code>src/plugin/host-process.cpp</code>. To enable this, simply run the follow and then
rebuild yabridge:</p>
<div class="highlight highlight-source-shell"><pre>meson configure build --buildtype=debug -Dwinedbg=true</pre></div>
</article>
</div>
</div>
</div>
</div>
</div>
</div>
